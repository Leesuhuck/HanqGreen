<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="egovframework.example.haksaengStatus.service.impl.HaksaengStatusMaper">

	<select id="selectHaksaengStatusServiceList" resultType="egovMap" parameterType="egovMap">
		SELECT *
		FROM 
			(SELECT FORMAT((@rowCount := @rowCount + 1),0) rowCount
			  , u.user_nm
			  , u.age
			  , u.cafe_nick
			  , u.phone
			  , gs.class_nm
			  , gs.gisu_nm
			  , gs.jucha_nm
			FROM t_user u
			JOIN t_gisu gs
			ON u.user_id = gs.user_id
			, (SELECT @rowCount := 0) rowCount
			
			UNION ALL
			
			SELECT FORMAT((@rowCount := @rowCount + 1),0) rowCount
				, u.user_nm
				, u.age
				, u.cafe_nick
				, u.phone
				, '생존전략'class_nm
				, '없음'gisu_nm
				, '없어요'jucha_nm
			FROM t_user u
			WHERE NOT EXISTS (SELECT null
								FROM t_gisu gs
								WHERE u.user_id = gs.user_id)) AS ATable
		<where>
			<if test="userNm != null and userNm != '' ">
				ATable.user_nm = #{userNm}
			</if>
		</where>
	</select>
</mapper>